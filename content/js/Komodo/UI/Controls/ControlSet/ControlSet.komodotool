{"keyboard_shortcut":"","name":"ControlSet","language":"JavaScript","trigger_enabled":false,"value":["/** ControlSet\r","* Manage extension`s ui elements\r","*\r","*/\r","ko.extensions.TemplateExtension.Komodo.Controls.ControlSet = (function()\r","{\r","\tfunction ControlSet()\r","\t{\r","\t\tvar self\t= this;\r","\t\tvar $\t= require('ko/dom');\r","\t\tvar document\t= document;\t\t\r","\t\tvar controlset;\r","\t\tvar controlset_element;\r","\t\t/** Set document where ControlSet is operating, pane or preferences window\r","\t\t *\r","\t\t * @param\tstring\t_document\r","\t\t * @return\tself \r","\t\t */\r","\t\tthis.document = function(_document)\r","\t\t{\r","\t\t\tdocument = _document;\r","\t\t\treturn this;\r","\t\t};\r","\t\t/** Set controlset_element\r","\t\t *\r","\t\t * @param\tstring\tcontrolset_element\r","\t\t * @return\tself \r","\t\t */\r","\t\tthis.element = function(controlset_selector)\r","\t\t{\r","\t\t\tcontrolset = self.$( controlset_selector );\r","\t\t\tcontrolset_element = controlset.element();\r","\t\t\treturn this;\r","\t\t};\r","\t\t\r","\t\t\r","\t\t/** Query selector in document\r","\t\t * \r","\t\t * @param\tstring\tselector\tSelector of node\r","\t\t * @param\tstring\tselector\tSelector of parent, if null, then current document is used\r","\t\t * \r","\t\t * @return\ttype\t[QueryObject](https://docs.activestate.com/komodo/11/sdk/api/module-ko_dom-QueryObject.html)\r","\t\t */\r","\t\tthis.$ = function(selector)\r","\t\t{\r","\t\t\t//parent = parent ? this.$(parent).element() : document;\r","\r","\t\t\treturn $(selector, document);\r","\t\t};\r","\t\t\r","\t\t/** create node\r","\t\t */\r","\t\tthis.create = function(type, attributes)\r","\t\t{\r","\t\t\treturn new ko.extensions.TemplateExtension.Komodo.Node()\r","\t\t\t\t\t\t\t\t\t\t .type(type)\t\t\t\t\t\t\t\t\t\t\t\t\t \r","\t\t\t\t\t\t\t\t\t\t .attributes(attributes)\r","\t\t\t\t\t\t\t\t\t\t .get();\r","\t\t};\r","\t\t\r","\t\t///** Get controls types\r","\t\t// */\r","\t\t//var getControlsLabels = function(markup_template)\r","\t\t//{\r","\t\t//\t\r","\t\t//}; \r","\t\t/** Create prefset dom with menu and toggable containers with controls.\r","\t\t * If exist, then prefset will be refreshed\r","\t\t *\r","\t\t * @param\tstring\tcontrolset_id\tId of wrapper element where menu and all containers are inserted\r","\t\t * @param\tobject\tmarkup_template\tRepresentation of container xul structure\r","\t\t * @param\tobject\tcontainers_data\tData for pref set`s controls\r","\t\t * @return\tself\t\r","\t\t *\r","\t\t * @example\r","\t\t *\t\tmarkup_template = { 'Prefset Caption': ['checkbox', 'textbox'] };\r","\t\t * \r","\t\t * \t\tcontainers_data = {\r","\t\t *\t\t\t'Container A':{\r","\t\t * \t\t\t\t'Control A':\ttrue,\r","\t\t * \t\t\t\tEnter Text A':\t'Foo Text A',\r","\t\t * \t\t\t}\r","\t\t * \t\t};\r","\t\t * \r","\t\t */\r","\t\tthis.load = function(containers_data)\r","\t\t{\r","\t\t\tvar containers\t= [];\r","\r","\t\t\tvar controlset_id\t= controlset.attr('id');\r","\t\t\tvar prefset_caption\t= controlset.attr('caption');\t\t\t\t\t\r","\t\t\t\t\t\t\r","\t\t\tvar markup_template\t= JSON.parse( controlset.attr('template') );\r","\t\t\t\r","\t\t\t//var container_labels\t= Array.isArray(markup_template) ? Object.keys(containers_data) : Object.keys(markup_template);\t\t\r","\t\t\tvar container_labels\t= Object.keys(containers_data);\r","\t\t\tvar container_class_shown\t= controlset_id+'-shown';\r","\t\t\t\r","\t\t\t/* MENU ELEMENTS ELEMENTS */\r","\t\t\tvar menu_box\t= self.create('hbox');\r","\t\t\tvar menu_main\t= self.create('menulist');\r","\t\t\tvar menu_adjust\t= self.create('button', { type: 'menu' });\r","\t\t\t\r","\t\t\t/** Create containers\r","\t\t\t */\r","\t\t\tvar createContainers = function()\r","\t\t\t{\r","\t\t\t\tfor(let i=0; i<container_labels.length;i++)\r","\t\t\t\t\tcontainers.push( self.container( container_labels[i], markup_template, containers_data[container_labels[i]] ) );\r","\t\t\t}; \r","\t\t\t/** Create main menu\r","\t\t\t */\r","\t\t\tvar createMainMenu = function()\r","\t\t\t{\r","\t\t\t\t/** Create markup_template\r","\t\t\t\t *\r","\t\t\t\t * @param\tobject\tcontrols_data\tContainer-id: {control id-label: value}\r","\t\t\t\t */\r","\t\t\t\tvar getMenuItem = function( container )\r","\t\t\t\t{\r","\t\t\t\t\tvar toggle_containers =\r","\t\t\t\t\t[\r","\t\t\t\t\t\t\"var container_class_shown='\"+container_class_shown+\"'\",\r","\t\t\t\t\t\t\"var element_hide=document.getElementsByClassName(container_class_shown)[0]\",\r","\t\t\t\t\t\t\"var element_show=document.getElementById('\"+container.getAttribute('id')+\"')\",\r","\t\t\t\t\t\t\r","\t\t\t\t\t\t\"if(element_hide==element_show)return\", // return if clicked same element\r","\t\t\t\t\t\t\r","\t\t\t\t\t\t\"element_show.classList.add(container_class_shown)\", // show new container\r","\t\t\t\t\t\t\"element_show.style.display = 'block'\",\r","\t\t\t\t\r","\t\t\t\t\t\t\"element_hide.classList.remove(container_class_shown)\", // hide old element\r","\t\t\t\t\t\t\"element_hide.style.display = 'none'\",\r","\t\t\t\t\t];\r","\t\t\t\t\t\r","\t\t\t\t\treturn self.create('menuitem', { 'id': container.getAttribute('id')+'-item', 'label': container.getAttribute('label'), 'oncommand': toggle_containers.join(';')} );\r","\t\t\t\t};\r","\t\t\t\t\r","\t\t\t\tvar menupopup\t= self.create('menupopup');\r","\t\t\t\t\r","\t\t\t\tfor(let i=0; i<containers.length;i++)\r","\t\t\t\t\tmenupopup.appendChild( getMenuItem(containers[i]) );\r","\t\t\t\t//console.log( menupopup.childNodes );\r","\t\t\t\tmenu_main.appendChild(menupopup);\r","\t\t\t}; \r","\t\t\t\r","\r","\t\t\t/** Compose menu\r","\t\t\t */\r","\t\t\tvar createAdjustMenu = function()\r","\t\t\t{\r","\t\t\t\tvar menupopup\t= self.create('menupopup');\r","\t\t\t\r","\t\t\t\tvar command_add = [\r","\t\t\t\t\t'var UI = TemplateExtension().UI(document)',\r","\t\t\t\t\t'UI.controlsetAddRemove( \"#'+controlset_id+'\",\"add\")',\r","\t\t\t\t];\r","\t\t\t\t\r","\t\t\t\tvar command_remove = [\r","\t\t\t\t\t//\"if('command_remove')\"\r","\t\t\t\t];\r","\t\t\t\t\r","\t\t\t\tvar menu_item_add\t= self.create('menuitem', { 'label': '+', 'oncommand': command_add.join(';')} );\r","\t\t\t\tvar menu_item_remove\t= self.create('menuitem', { 'label': '-', 'oncommand': command_remove.join(';')} );\r","\t\t\t\r","\t\t\t\tmenupopup.appendChild( menu_item_add );\r","\t\t\t\tmenupopup.appendChild( menu_item_remove );\r","\t\t\t\t\r","\t\t\t\tmenu_adjust.appendChild( menupopup );\r","\t\t\t};\r","\t\t\t/** Add caption\r","\t\t\t */\r","\t\t\tvar addCaption = function()\r","\t\t\t{\r","\t\t\t\tcontrolset.append( self.create('caption', prefset_caption));\r","\t\t\t}; \r","\t\t\t/** Compose menu\r","\t\t\t */\r","\t\t\tvar addMenus = function()\r","\t\t\t{\r","\t\t\t\tmenu_box.appendChild( menu_main );\r","\t\t\t\tmenu_box.appendChild( menu_adjust );\r","\t\t\t\t\r","\t\t\t\tcontrolset.append( menu_box );\r","\t\t\t};\r","\t\t\t/** Add containers\r","\t\t\t */\r","\t\t\tvar addContainers = function()\r","\t\t\t{\r","\t\t\t\tfor(let i=0; i<containers.length;i++)\r","\t\t\t\t\tcontrolset.append(containers[i]);\r","\t\t\t}; \r","\t\t\t\r","\t\t\tcreateContainers();\r","\t\t\tcreateMainMenu();\r","\t\t\tcreateAdjustMenu();\r","\t\t\t\r","\t\t\taddCaption();\r","\t\t\taddMenus();\r","\t\t\taddContainers();\r","\r","\t\t\treturn this; \r","\t\t};\r","\r","\t\t/**  \r","\t\t *\t\r","\t\t */\r","\t\tthis.container = function(container_label, markup_template, controls_data=null)\r","\t\t{\r","\t\t\t//var controls_labels\t= Object.keys(controls_data);\r","\t\t\t\r","\t\t\tvar control_types\t= Array.isArray(markup_template) ? markup_template\t: Object.keys(markup_template);\r","\t\t\t//controls_data\t= Array.isArray(markup_template) ? controls_data\t: Object.values(markup_template);\r","\t\t\t\r","\t\t\tconsole.log('---markup_template');\r","\t\t\tconsole.log( markup_template );\r","\t\t\t/** Container_labels\r","\t\t\t */\r","\t\t\tvar controls_labels = (function()\r","\t\t\t{\r","\t\t\t\tif( controls_data )\r","\t\t\t\t\treturn Object.keys(controls_data);\r","\t\t\t\t//console.log('Object.values(markup_template)');\r","\t\t\t\t//console.log( Object.keys(markup_template) );\r","\t\t\t\treturn Object.keys(markup_template).map(function(key){\r","\t\t\t\t\treturn markup_template[key].label;\r","\t\t\t\t}); \r","\r","\t\t\t})(); \r","\t\t\t//console.log('---controls_labels');\r","\t\t\t//console.log( controls_labels );\r","\t\t\t//\r","\t\t\t//console.log('---controls_data');\r","\t\t\t//console.log( controls_data );\r","\t\t\t/** container\r","\t\t\t */\r","\t\t\tvar container = (function()\r","\t\t\t{\r","\t\t\t\tvar container\t= self.create( 'groupbox', {\r","\t\t\t\t\t\t\t\t\t\t'label': container_label,\t// sanitized label become id attribute, label is for save and restore element from prefs\r","\t\t\t\t\t\t\t\t\t\t'class': 'controlset-container',\t// class 'prefset-container' is for identification of container in prefset DOM\r","\t\t\t\t\t\t\t\t });\r","\t\t\t\treturn container;\r","\t\t\t})();\r","\t\t\t\r","\t\t\t/** Append control to container\r","\t\t\t */\r","\t\t\tvar appendControlToContainer = function(index)\r","\t\t\t{\r","\t\t\t\t//var control_type\t= control_types[index];\r","\t\t\t\tvar control_data\t= {'label': controls_labels[index], 'value': controls_data ? controls_data[controls_labels[index]] : '' };\r","\t\t\t\tvar control\t= self.create(control_types[index], control_data);\r","\t\t\t\t\r","\t\t\t\t/** Add label if not checkbox \r","\t\t\t\t */\r","\t\t\t\tvar label_box = (function()\r","\t\t\t\t{\r","\t\t\t\t\tif( control.nodeName === 'checkbox' )\r","\t\t\t\t\t\treturn;\r","\t\t\t\t\t\r","\t\t\t\t\tvar hbox\t= self.create( 'hbox' );\r","\t\t\t\t\tvar label\t= self.create('label', {'value': controls_labels[index], 'control': control.getAttribute('id')});\r","\t\t\t\t\r","\t\t\t\t\thbox.appendChild( label );\r","\t\t\t\t\thbox.appendChild( control );\r","\t\t\t\t\t\r","\t\t\t\t\treturn hbox;\r","\t\t\t\t})(); \r","\t\t\t\t\r","\t\t\t\tcontainer.appendChild( label_box ? label_box : control );\r","\t\t\t};\r","\t\t\t\r","\t\t\tfor(let c=0; c<controls_labels.length;c++)\r","\t\t\t\tappendControlToContainer(c);\r","\t\t\t\t\r","\t\t\treturn container;\r","\t\t};\r","\t\t\r","\t\t/** select\r","\t\t */\r","\t\tthis.select = function(select_index)\r","\t\t{\r","\t\t\tcontrolset.find( 'menulist' ).first().element().selectedIndex = select_index;\r","\t\t\t/* Hide containers  */\r","\t\t\tcontrolset.find('.controlset-container').each(function(index) // class 'controlset-container' is important, it is defined in ControlSet class\r","\t\t\t{\r","\t\t\t\tif( index==select_index )\r","\t\t\t\t\tthis.classList.add( controlset.attr('id')+'-shown' );\r","\t\t\t\telse\r","\t\t\t\t\tthis.setAttribute('style', this.getAttribute('style') +';display:none;');\r","\t\t\t});\r","\t\t}; \r","\t\t/** test\r","\t\t */\r","\t\tthis.test = function()\r","\t\t{\r","\t\t\talert( 'ControlSet.test()' );\r","\t\t}; \r","\t}\r","\treturn ControlSet;\r","\r","})();"],"version":"1.0.12","rank":100,"async":false,"type":"macro","trigger":"trigger_postopen"}