{"keyboard_shortcut":"","name":"UI","language":"JavaScript","trigger_enabled":false,"value":["/** Manage xul elements\r","*\r","*\r","* ADDITIONAL ATTRIBUTES of xul elements:\r","*\t\tprefs=\"false\"\t// value of this element will not saved as preference\t\r","* \r","* @Example\r","*\t<checkbox\tlabel=\"Example of attributes\"\t\r","*\t\tprefs=\"false\"\t\r","* \t/>\r","*\r","*/\r","ko.extensions.TemplateExtension.Komodo.UI = (function()\r","{\r","\tfunction UI()\r","\t{\r","\t\tvar self\t= this;\r","\t\tvar $\t= require('ko/dom');\r","\t\tvar document\t= document;\t\t\r","\t\tvar control_types\t= ['checkbox','textbox','radio'];\r","\t\r","\t\t/*\t\tSETUP\r","\t\t-----------------------------------------*/\r","\t\r","\t\t/** Set document where UI is operating, pane or preferences window\r","\t\t *\r","\t\t * @param\tstring\t_document\r","\t\t * @return\tself \r","\t\t */\r","\t\tthis.document = function(_document)\r","\t\t{\r","\t\t\tdocument = _document;\r","\t\t\t\r","\t\t\treturn this;\r","\t\t};\r","\r","\t\t/** Query selector in document\r","\t\t * \r","\t\t * @param\tstring\tselector\tSelector of node\r","\t\t * @param\tstring\tselector\tSelector of parent, if null, then current document is used\r","\t\t * \r","\t\t * @return\ttype\t[QueryObject](https://docs.activestate.com/komodo/11/sdk/api/module-ko_dom-QueryObject.html)\r","\t\t */\r","\t\tthis.$ = function(selector, parent=null)\r","\t\t{\r","\t\t\tparent = parent ? this.$(parent).element() : document;\r","\r","\t\t\treturn $(selector, parent);\r","\t\t};\r","\t\t/** Exists\r","\t\t */\r","\t\tthis.exists = function(selector, parent=null)\r","\t\t{\r","\t\t\treturn typeof this.$(selector, parent).element()!=='undefined';\r","\t\t}; \r","\t\t/** Create dom element or elements\r","\t\t * \r","\t\t * @param\tstring\ttype\tType of node to append\r","\t\t * @param\tnull|string|array|object|[object] \t[attributes]\tAttributes for control(s)\r","\t\t * @param\t[type, attributes]\tchildren\tArray of attributes [type, attributes, create] for nested loop of create() function\r","\t\t * \r","\t\t * @return element|[elements] created node or array of created nodes\r","\t\t * \r","\t\t * @example of parameter 'attributes'\r","\t\t *\t\t.create('checkbox', 'Checkbox 1')\t// STRING:\tsingle node\r","\t\t *\t\t.create('checkbox', ['Checkbox 1', 'Checkbox 2'])\t// ARRAY OF STRINGS:\tmultiple nodes\r","\t\t *\t\t.create('checkbox', {label:  'Checkbox 1'})\t// OBJECT:\tsingle node with attributes\r","\t\t *\t\t.create('checkbox', [{label: 'Checkbox 1'}, {label: 'Checkbox 2'}])\t// ARRAY OF OBJECTS:\tmultiple nodes with attributes\r","\t\t *\r","\t\t * @example of parameter 'children' \r","\t\t *\t\t.create('groupbox')\t\t// node without attributes\r","\t\t *\t\t.create('groupbox', null,\t['checkbox', ['Checkbox 1', 'Checkbox 2']] )\t// node with children\r","\t\t *\t\t.create('groupbox', {id: 'gp_id'},\t['checkbox', ['Checkbox 1', 'Checkbox 2']] )\t// node with attributes and children\r","\t\t */\r","\t\tthis.create = function(type, attributes=null, children=null)\r","\t\t{\r","\t\t\t//console.log('UI.create(\"'+type+'\")'); \r","\t\t\t/** Sanitize attributes\r","\t\t\t */\r","\t\t\tattributes = (function()\r","\t\t\t{\r","\t\t\t\treturn ! attributes ? [{}] : ( ! Array.isArray(attributes) ? [attributes] : attributes );\t\t\t\t\r","\t\t\t})();\r","\r","\t\t\tvar created_nodes = attributes.map(function(node_attributes)\r","\t\t\t{\r","\t\t\t\t//console.log(  'created_nodes: ' + type +' '+node_attributes.id );\r","\t\t\t\treturn new ko.extensions.TemplateExtension.Komodo.Node()\r","\t\t\t\t\t\t\t\t\t\t\t .type(type)\t\t\t\t\t\t\t\t\t\t\t\t\t \r","\t\t\t\t\t\t\t\t\t\t\t .attributes(node_attributes)\r","\t\t\t\t \t\t\t\t\t\t\t .get();\r","\t\t\t});\r"," \r","\t\t\t/** Last node\r","\t\t\t */\r","\t\t\tvar lastNode = created_nodes[created_nodes.length-1];\r","\t\t\t\r","\t\t\tif( children )\r","\t\t\t\tlastNode.appendChild ( this.create(children[0], children[1], children[2]) );\r","\t\t\t\r","\t\t\treturn created_nodes.length > 1 ? created_nodes : lastNode ;\r","\t\t};\r","\t\t/** Delete element\r","\t\t */\r","\t\tthis.delete = function(selector_or_element, parent=null)\r","\t\t{\r","\t\t\tvar element\t= typeof selector_or_element === 'string' ? this.$(selector_or_element, parent) : selector_or_element;\r","\t\t\telement.parentNode.removeChild(element);\r","\t\t};\r","\t\t\r","\t\t/** Get\\Set values of controls\r","\t\t *\r","\t\t * @param\tstring\tparam1\r","\t\t * @param\tmixed\tparam2\tif not false, then take only nodes without attribute prefs=\"false\"\r","\t\t * @return\t{id: value}\tObject of node ids and values\r","\t\t *\r","\t\t * @example values()\t// GET all values from docuent\r","\t\t * @example values('id')\t// GET all values from element\r","\t\t * @example values('only-prefs')\t// GET preferences values from docuent\r","\t\t * @example values('id', 'only-prefs')\t// GET preferences values from element\r","\t\t * \r","\t\t * @example values({'id': 'value to set'})\t// mass SET values by object\r","\t\t * \r","\t\t */\r","\t\tthis.values = function(param1, param2=false)\r","\t\t{\r","\t\t\tconsole.log(  'UI.values()' );\r","\t\t\treturn typeof param1 === 'object' ? setValues(param1) : getValues(param1, param2) ;\r","\t\t};\r","\t\t\r","\t\t/** Get\\Set element value\r","\t\t *\r","\t\t * @param\tstring\tparam1\tSelector of element to get\\set value\r","\t\t * @param\tstring\tparam2\tValue of element to set\r","\t\t * @return mixed          Current value of element \r","\t\t *\r","\t\t * @example value('#selector')\t// get value of element\r","\t\t * @example value('#selector', 'value')\t// set value to element\r","\t\t */\r","\t\tthis.value = function(param1=null, param2=null)\r","\t\t{\r","\t\t\tvar element\t= typeof param1 === 'string' ? this.$(param1).element() : param1;\r","\t\t\t\r","\t\t\treturn param2 ? setValue(element, param2) : getValue(element);\r","\t\t};\r","\r","\t\t/** Append new children to node\r","\t\t *\r","\t\t * @param\tnode|string \tparent\tNode element or selector of parent to append children\r","\t\t * @param\telement|array\telements\tElement to append\r","\t\t * \r","\t\t * @return\tself \r","\t\t */\r","\t\tthis.append = function( parent_selector, elements )\r","\t\t{\r","\t\t\t//console.log( 'UI.append()' );\r","\t\t\t//console.log( elements );\r","\t\t\tparent = this.$(parent_selector);\r","\t\t\t\r","\t\t\t/** Parent id exists\r","\t\t\t *  it should EXISTS\r","\t\t\t */\r","\t\t\tvar parentIdExists = function()\r","\t\t\t{\r","\t\t\t\tif( self.exists(parent_selector) )\r","\t\t\t\t\treturn true;\r","\t\t\t\t\r","\t\t\t\talert( 'UI.append()\\n\\nPARENT ELEMENT DOES NOT EXISTS: '+parent_selector );\r","\t\t\t\treturn false;\r","\t\t\t}; \r","\t\t\t\r","\t\t\t///** Id not exists\r","\t\t\t// *  it should NOT EXISTS\r","\t\t\t// */\r","\t\t\t//var childIdExists = function(id)\r","\t\t\t//{\r","\t\t\t//\tconsole.log('childIdExists: '+id); \r","\t\t\t//\t//if( ! id || ! self.exists('#'+id, parent) )\r","\t\t\t//\tif( ! self.exists('#'+id) )\t\t\t\r","\t\t\t//\t\treturn false;\r","\t\t\t//\t\r","\t\t\t//\t//alert( 'UI.append()\\n\\nCHILD ID ALREADY EXISTS: #'+id );\r","\t\t\t//\talert( 'UI.append()\\n\\nChild in parent alerady exists\\n\\nPARENT: '+parent_selector+'\\nCHILD:    #'+id );\t\t\t\t\r","\t\t\t//\treturn true;\r","\t\t\t//};\r","\t\t\t\r","\t\t\tif( ! parentIdExists() )\r","\t\t\t\treturn;\r","\t\t\t \r","\t\t\tif( ! Array.isArray(elements) )\r","\t\t\t\telements = [elements];\t\r","\t\t\t\r","\t\t\tfor(let e=0; e<elements.length;e++)\r","\t\t\t\tparent.element().appendChild( elements[e] );\t\t\t\t\r","\t\t\t\r","\t\t\treturn this;\r","\t\t};\r","\t\t\r","\t\t/** Remove child elements\r","\t\t * @param\tstring\tselector\tSelector of node\r","\t\t * @return\tself\r","\t\t */\r","\t\tthis.empty = function(selector, parent=null)\r","\t\t{\r","\t\t\tthis.$(selector, parent).empty();\r","\t\t\t\r","\t\t\treturn this;\r","\t\t};\r","\t\t\r","\t\t/*\t\tPREFSET DOM\r","\t\t-----------------------------------------*/\r","\t\t\r","\t\t/** Get Controlset class\r","\t\t * @return\tobject [ControlSet](Controls/ControlSet)\r","\t\t */\r","\t\tthis.controlset = function()\r","\t\t{\r","\t\t\treturn  new ko.extensions.TemplateExtension.Komodo.Controls.ControlSet().document(document);\r","\t\t};\r","\r","\t\t/** Get Dropdown class\r","\t\t * @param\tstring\tselector\tSelector of dropdown menu\r","\t\t * @return\tobject [Dropdown](Controls/Dropdown)\r","\t\t */\r","\t\tthis.dropdown = function(selector=null)\r","\t\t{\r","\t\t\tvar dropdown =  new ko.extensions.TemplateExtension.Komodo.Controls.Dropdown().document(document);\r","\t\t\r","\t\t\tif( selector )\r","\t\t\t\tdropdown.element( this.$(selector) );\r","\t\t\t\r","\t\t\treturn dropdown;\r","\t\t}; \r","\t\t\r","\t\t/*\t\tPRIVATE VALUE METHODS\r","\t\t-----------------------------------------*/\r","\t\t\r","\t\t/** Get values from controls\r","\t\t *\r","\t\t * @param\tstring\tselector\tSelector of node or parent nodes whereto get values\r","\t\t * @param\tmixed\tonly_prefs\tIf not false then only elements withthout attribute prefs=\"false\" will be processed\r","\t\t * @return\t{id: value}\t            Object with elements ids and current values\r","\t\t */\r","\t\tvar getValues = function(selector, only_prefs=false)\r","\t\t{\r","\t\t\tconsole.log(  'UI.getValues()' );\r","\t\t\tvar values\t= {};\r","\t\t\t\r","\t\t\t/** Get values form child nodes\r","\t\t\t * @param\tarray\tchild_nodes\tElement list of child nodes\r","\t\t\t */\r","\t\t\tvar loopNestedElements = function(child_nodes)\r","\t\t\t{\r","\t\t\t\t//console.log('loopNestedElements');\r","\t\t\t\t//console.log( child_nodes );\r","\t\t\t\t/** Test if getting only preferences,\r","\t\t\t\t* \t\tif so, then if control has not \r","\t\t\t\t*/\r","\t\t\t\tvar preferenceTest = function(element)\r","\t\t\t\t{\r","\t\t\t\t\treturn only_prefs===false || element.getAttribute('prefs')!=='false';\r","\t\t\t\t}; \r","\t\t\t\t\r","\t\t\t\t/** Set to value to values object\r","\t\t\t\t */\r","\t\t\t\tvar setToValues = function(id, value)\r","\t\t\t\t{\r","\t\t\t\t\t//console.log(  'setToValues(): ' + id +', '+ value );\r","\t\t\t\t\tif( value!==null )\r","\t\t\t\t\t\tvalues[id] = value;\r","\t\t\t\t};\r","\t\t\t\t\r","\t\t\t\t/** Get prefset values\r","\t\t\t\t */\r","\t\t\t\tvar setControlsetValues = function(container)\r","\t\t\t\t{\r","\t\t\t\t\t//console.log('setControlsetValues()');\r","\t\t\t\t\tvar container_values\t= {};\r","\t\t\t\t\t\r","\t\t\t\t\t$(container).find( control_types.join(',') ).each(function()\r","\t\t\t\t\t{\r","\t\t\t\t\t\tvar value = preferenceTest(this) ? self.value( this ) : null;\r","\t\t\t\t\t\t\t\r","\t\t\t\t\t\tcontainer_values[this.getAttribute('label')] = value;\r","\t\t\t\t\t});\r","\t\t\t\t\t\r","\t\t\t\t\tvar controlset\t= $(container).parent();\r","\t\t\t\t\tvar controlset_id\t= controlset.attr('id');\r","\t\r","\t\t\t\t\tif( typeof values[controlset_id] === 'undefined'  )\r","\t\t\t\t\t\tvalues[controlset_id] = {};\r","\t\t\t\t\t\r","\t\t\t\t\tvalues[controlset_id][$(container).attr('label')] = container_values;\r","\t\t\t\t};\r","\t\t\t\t\r","\t\t\t\tchild_nodes.each(function()\r","\t\t\t\t{\r","\t\t\t\t\tvar id\t= this.getAttribute('id');\r","\t\t\t\t\t\r","\t\t\t\t\tif( ! Object.keys(this.childNodes).length ){\r","\t\t\t\t\t\tif( preferenceTest(this) )\r","\t\t\t\t\t\t\tsetToValues( id, self.value(this) );\r","\t\t\t\t\t\t\t\t\r","\t\t\t\t\t}else if( this.classList.contains('controlset-container') )\r","\t\t\t\t\t\tsetControlsetValues( this );\r","\t\t\t\t\t\r","\t\t\t\t\telse\r","\t\t\t\t\t\tloopNestedElements( $(this.childNodes) );\r","\t\t\t\t});\r","\t\t\t}; \r","\r","\t\t\tloopNestedElements( self.$(selector).children() );\r","\r","\t\t\treturn values;\r","\t\t};\r","\r","\t\t/** Set values to elements\r","\t\t * @param\t{id: value}\tvalues_data\tObject with ids and valuest to set\r","\t\t */\r","\t\tvar setValues = function(values_data)\r","\t\t{\r","\t\t\tconsole.log(  'UI.setValues()');\r","\t\t\tfor(var id in values_data)\r","\t\t\t\tif (values_data.hasOwnProperty(id))\r","\t\t\t\t\tsetValue( '#' + id,  values_data[id] );\r","\t\t};\r","\r","\t\t/** Get element value\r","\t\t * @param\tobject\telement\tElement node for get value\r","\t\t */\r","\t\tvar getValue = function(element)\r","\t\t{\r","\t\t\t//console.log(  'UI.getValue()');\r","\r","\t\t\tvar is_control_node = control_types.indexOf( element.nodeName ) > -1;\r","\t\t\t\r","\t\t\tif( ! is_control_node || ! element.id )\r","\t\t\t\treturn null;\r","\t\t\t//console.log(  'getValue()' );\r","\t\t\t//console.log( element );\r","\t\t\t\r","\t\t\treturn element.nodeName == 'checkbox' ? element.checked : element.value;\r","\t\t};\r","\t\t\r","\t\t/** Set element value\r","\t\t * @param\tstring\tselector\tSelector of element for set value\r","\t\t * @param\tmixed\tvalue\tValue of element\r","\t\t */\r","\t\tvar setValue = function(selector, value)\r","\t\t{\r","\t\t\t//console.log(  'setValue()' );\r","\t\t\t//console.log( selector );\r","\t\t\t//console.log( value );\r","\t\t\t\r","\t\t\tvar element\t= self.$(selector).element();\r","\t\t\t\r","\t\t\tif( ! self.exists(selector) )\r","\t\t\t\treturn exception( 'Control '+selector+' does not exists' );\r","\t\t\t\t\t\t\r","\t\t\tif( typeof value === 'object'  )\r","\t\t\t\tself.controlset().element(element).load(value);\r","\t\t\t\r","\t\t\telse if( element.nodeName === 'checkbox' )\r","\t\t\t\t element.checked = value;\r","\t\t\t\r","\t\t\telse\r","\t\t\t\telement.value = value;\r","\t\t}; \r","\t\r","\t\t/** Get sanitized id\r","\t\t */\r","\t\tvar sanitizeId = function(id)\r","\t\t{\r","\t\t\treturn id.replace(/[^a-z0-9\\s-_]/gi, '').replace(/\\s+/gi, '_').trim().toLowerCase();\r","\t\t};\r","\t\t/** Thrownotification warning message\r","\t\t */\r","\t\tvar exception = function(message)\r","\t\t{\r","\t\t\tko.statusBar.AddMessage( message, 'TemplateExtension', 0, true); \r","\t\t\treturn; \r","\t\t}; \r","\t\t/** test\r","\t\t */\r","\t\tthis.test = function()\r","\t\t{\r","\t\t\talert( 'UI.test()' );\r","\t\t}; \r","\t}\r","\treturn UI;\r","\r","})();"],"version":"1.0.12","rank":100,"async":false,"type":"macro","trigger":"trigger_postopen"}